<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Management App</title>
</head>

<body>
  <h1>Task App</h1>
  <button id="btnAdd">Add Task</button>
  <div id="taskContainer"></div>

  <script>
    const tasks = [];
    const taskContainerEl = document.getElementById('taskContainer');

    function renderTasks() {
      taskContainerEl.innerHTML = '';

      tasks.forEach((task, idx) => {
        const taskEl = document.createElement('div');
        taskEl.className = 'task';
        taskEl.innerHTML = generateTaskHtml(task, idx);
        taskContainerEl.appendChild(taskEl);
      });

      attachEventListeners();
    }

    function generateTaskHtml(task, idx) {
      if (task._isEditing) {
        return `
          <label for="task.${idx}.name">Task Name</label>
          <input id="task.${idx}.name" value="${task.name}" />
          <br>
          <div>
            <button onClick="saveTask(${idx})">Save</button>
            <button onClick="deleteTask(${idx})">Delete</button>
          </div>
        `;
      } else if (task._isAddingSubtask) {
        return `
          <label for="task.${idx}.subtask">Subtask Name</label>
          <input id="task.${idx}.subtask" />
          <br>
          <button onClick="saveSubtask(${idx})">Save Subtask</button>
          <button onClick="cancelAddSubtask(${idx})">Cancel</button>
        `;
      } else {
        return `
          <h2>Task Name: ${task.name}</h2>
          ${generateSubtaskHtml(task.subtasks, idx)}
          <button onClick="addSubtask(${idx})">Add Subtask</button>
          <button onClick="editTask(${idx})">Edit</button>
          <button onClick="deleteTask(${idx})">Delete</button>
        `;
      }
    }

    function generateSubtaskHtml(subtasks, taskIdx) {
      return subtasks.map((subtask, subIdx) => `
        <p>Subtask ${subIdx + 1}: ${subtask}
          <button onClick="editSubtask(${taskIdx}, ${subIdx})">Edit</button>
          <button onClick="deleteSubtask(${taskIdx}, ${subIdx})">Delete</button>
        </p>`).join('');
    }

    function attachEventListeners() {
      // Attach event listeners to buttons
    }

    function addTask() {
      tasks.push({
        name: '',
        subtasks: [],
        _isEditing: true,
        _isAddingSubtask: false,
      });
      renderTasks();
    }

    function editTask(idx) {
      tasks[idx]._isEditing = true;
      renderTasks();
    }

    function saveTask(idx) {
      const taskName = document.getElementById(`task.${idx}.name`).value;
      tasks[idx].name = taskName;
      tasks[idx]._isEditing = false;
      renderTasks();
    }

    function deleteTask(idx) {
      tasks.splice(idx, 1);
      renderTasks();
    }

    function addSubtask(taskIdx) {
      tasks[taskIdx]._isAddingSubtask = true;
      renderTasks();
    }

    function saveSubtask(taskIdx) {
      const subtaskName = document.getElementById(`task.${taskIdx}.subtask`).value;
      tasks[taskIdx].subtasks.push(subtaskName);
      tasks[taskIdx]._isAddingSubtask = false;
      renderTasks();
    }

    function cancelAddSubtask(taskIdx) {
      tasks[taskIdx]._isAddingSubtask = false;
      renderTasks();
    }

    function editSubtask(taskIdx, subtaskIdx) {
      tasks[taskIdx]._editingSubtask = subtaskIdx;
      renderTasks();
    }

    function saveEditedSubtask(taskIdx, subtaskIdx) {
      const editedSubtask = document.getElementById(`task.${taskIdx}.${subtaskIdx}.subtask`).value;
      tasks[taskIdx].subtasks[subtaskIdx] = editedSubtask;
      tasks[taskIdx]._editingSubtask = undefined;
      renderTasks();
    }

    function deleteSubtask(taskIdx, subtaskIdx) {
      tasks[taskIdx].subtasks.splice(subtaskIdx, 1);
      renderTasks();
    }

      function attachEventListeners() {
          tasks.forEach((task, idx) => {
            if (task._editingSubtask !== undefined) {
              // Attach event listeners for editing subtask
              const subIdx = task._editingSubtask;
              const saveSubtaskBtn = document.getElementById(`saveSubtask.${idx}.${subIdx}`);
              saveSubtaskBtn.addEventListener('click', () => saveEditedSubtask(idx, subIdx));

              // Attach event listeners for canceling editing subtask
              const cancelSubtaskBtn = document.getElementById(`cancelSubtask.${idx}.${subIdx}`);
              cancelSubtaskBtn.addEventListener('click', () => cancelEditSubtask(idx));
              
            }
          });
        }


    // Initialize the app
    document.getElementById('btnAdd').addEventListener('click', addTask);
    document.addEventListener('DOMContentLoaded', renderTasks);
  </script>

  <style>
    .task {
      border:1px solid #ccc;
      margin: 10px;
      padding: 10px;
    }
  </style>
  </body>
  
  </html>